
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<script type="text/javascript" src="http://d3js.org/d3.v3.js"></script>
<style>

#connections {
    overflow: auto;
}

/* font for all visible node text */
.node_label {
    fill: black;
    font-size: 12px;
    font-family: sans-serif;
}

.left_label {
    text-anchor: end;
}

.right_label {
    text-anchor: start;
}

#center_lines {

}

.link {
  fill: none;
  stroke: #ccc;
  stroke-width: 1.5px;
}

</style>
</head>
<body>
<script type="text/javascript">

var data = <connection_data>;

window.onload = function() {

    var w=window.innerWidth, h=window.innerHeight;
    var diagonal = d3.svg.diagonal()
         .source(function f(d) {
             return {"x": d.source.x, "y": d.source.y }}
         )
         .target(function f(d) {
             return {"x": d.target.x, "y": d.target.y }}
         );

    var srcs = data.srcs;
    var targets = data.targets;
    var link_data = data.links;
    // var right_nodes = [];
    // var left_nodes = [];

    var left_labels = d3.select("#left_labels");

    left_labels.selectAll("text")
        .data(srcs)
        .enter().append("text")
        .attr("class", "node_label")
        .attr("class", "left_label")
		.attr('dy', '.5em')
		.text(function(d,i){ return d.name });

    var text_height = d3.select('.left_label').node().getBBox().height;
    var left_width = left_labels.node().getBBox().width;

    d3.selectAll('.left_label')
        .attr('x', function(d, i) { return left_width })
        .attr('y', function(d, i) { return i*text_height })
        .each(function (d, i) { d.x = left_width; d.y = i*text_height; });

    var right_labels = d3.select("#right_labels");

    right_labels.selectAll("text")
        .data(targets)
        .enter().append("text")
        .attr("class", "node_label")
        .attr("class", "right_label")
		.attr('y', function(d,i) { return i*text_height; })
		.attr('dy', '.5em')
		.text(function(d,i){ return d.name });

    var right_width = right_labels.node().getBBox().width;

    d3.selectAll('.right_label')
        .attr('x', function(d, i) { return w - right_width; })
        .each(function (d, i) { d.x = w-right_width; d.y = i*text_height; });

    var left_height = d3.select('#left_labels').node().getBBox().height
    var right_height = d3.select('#right_labels').node().getBBox().height
    var max_height = 0;

    if (left_height > right_height) {
        max_height = left_height;
    }
    else {
        max_height = right_height;
    }

    var svg = d3.select("svg")
        .style("height", max_height + "px")
        .style("width", w + "px");

    for (i = 0; i < link_data.length; i++) {
        link_data[i].source = srcs[i];
        link_data[i].target = targets[i];
    }

    var links = d3.select("#center_lines").selectAll(".link")
        .data(link_data)
      .enter().append("path")
        .attr("class", "link")
        .attr("d", diagonal);

}
</script>
<div id="connections">
    <svg>
        <g id="left_labels">
        </g>
        <g id="center_lines">
        </g>
        <g id="right_labels">
        </g>
    </svg>
</div>
</body>
</html>
